<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <title>Resumo do Dia</title>
    <style>
        :root {
            --bg-body: #f8f9fa;
            --bg-card: #ffffff;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --primary: #0d6efd;
            --success: #198754;
            --danger: #dc3545;
        }
        body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Arial, sans-serif; margin: 0; background: var(--bg-body); color: var(--text-primary); }
        .container { max-width: 1200px; margin: auto; padding: 20px; }
        .card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: .75rem; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,.05); margin-bottom: 1.5rem; }
        h1, h2 { color: var(--text-primary); margin-top: 0; }
        h1 { font-size: 1.75rem; font-weight: 700; }
        h2 { font-size: 1.25rem; font-weight: 600; border-bottom: 1px solid var(--border-color); padding-bottom: .5rem; margin-bottom: 1rem; }
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; }
        .kpi-item { background: #f8f9fa; padding: 1rem; border-radius: .5rem; border: 1px solid var(--border-color); }
        .kpi-item .label { font-size: .9rem; color: var(--text-secondary); }
        .kpi-item .value { font-size: 1.5rem; font-weight: 700; margin-top: .25rem; }
        .kpi-item .base-info { font-size: 0.8rem; color: var(--text-secondary); margin-top: .25rem; }
        .text-success { color: var(--success); }
        .text-danger { color: var(--danger); }
        .details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .details-item .label { color: var(--text-secondary); font-size: .9rem; }
        .details-item .value { font-weight: 600; font-size: 1.1rem; }
        .highlight-box { background: #f8f9fa; padding: .75rem; border-radius: .5rem; text-align: center; }
        .table { width: 100%; border-collapse: collapse; }
        .table th, .table td { padding: .75rem; border-bottom: 1px solid var(--border-color); text-align: left; vertical-align: middle; }
        .table th { background: #f8f9fa; font-weight: 600; }
        .table tfoot td { font-weight: 700; }
        .text-right { text-align: right; }
        .grid-layout { display: grid; grid-template-columns: repeat(12, 1fr); gap: 1.5rem; }
        .col-span-12 { grid-column: span 12; }
        .col-span-8 { grid-column: span 8; }
        .col-span-4 { grid-column: span 4; }
        @media (max-width: 992px) {
            .col-span-8, .col-span-4 { grid-column: span 12; }
        }
    </style>
</head>
<body>
    {% include "_topbar.html" %}
    <div class="container">
        <!-- CABEÇALHO E KPIS PRINCIPAIS -->
        <div class="card">
            <h1>Resumo do Dia: {{ dia_semana }}, {{ registro.data }}</h1>
            <div class="kpi-grid">
                <div class="kpi-item">
                    <div class="label">Valor Total de Vendas</div>
                    <div class="value">{{ totais.total_vendas|currency_br }}</div>
                </div>
                <div class="kpi-item">
                    <div class="label">Quantidade de Pedidos</div>
                    <div class="value">{{ totais.total_pedidos }}</div>
                </div>
                <div class="kpi-item">
                    <div class="label">Ticket Médio</div>
                    <div class="value">{{ totais.ticket_medio|currency_br }}</div>
                </div>
                <div class="kpi-item">
                    <div class="label">Variação vs. Semana Passada</div>
                    <div class="value {{ 'text-success' if wow.percent >= 0 else 'text-danger' }}">
                        {% if wow.percent > 0 %}▲{% elif wow.percent < 0 %}▼{% endif %}
                        {{ wow.percent|round(1)|abs }}%
                    </div>
                    <div class="base-info">Base: {{ wow.base_data or '—' }} ({{ wow.base_vendas|currency_br if wow.base_vendas is not none else '—' }})</div>
                </div>
            </div>
        </div>

        <div class="grid-layout">
            <!-- COLUNA PRINCIPAL -->
            <div class="col-span-8">
                 <!-- VENDAS POR MAQUININHA -->
                <div class="card">
                    <h2>Vendas por Maquininha</h2>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Maquininha</th>
                                <th class="text-right">Débito</th>
                                <th class="text-right">Crédito</th>
                                <th class="text-right">PIX</th>
                                <th class="text-right">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for m in maqs %}
                            <tr>
                                <td>{{ m.nome }}</td>
                                <td class="text-right">{{ m.debito|currency_br }}</td>
                                <td class="text-right">{{ m.credito|currency_br }}</td>
                                <td class="text-right">{{ m.pix|currency_br }}</td>
                                <td class="text-right"><strong>{{ m.total|currency_br }}</strong></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot>
                            <tr>
                                <td>Total por Meio</td>
                                <td class="text-right">{{ totais_meio.debito|currency_br }}</td>
                                <td class="text-right">{{ totais_meio.credito|currency_br }}</td>
                                <td class="text-right">{{ totais_meio.pix|currency_br }}</td>
                                <td class="text-right">
                                    <strong>{{ (totais_meio.debito + totais_meio.credito + totais_meio.pix)|currency_br }}</strong>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                
                <!-- TOTAIS POR MEIO -->
                <div class="card">
                    <h2>Totais por Meio</h2>
                    <table class="table">
                        <tbody>
                            <tr>
                                <td>Débito</td>
                                <td class="text-right"><strong>{{ totais_meio.debito|currency_br }}</strong></td>
                            </tr>
                            <tr>
                                <td>Crédito</td>
                                <td class="text-right"><strong>{{ totais_meio.credito|currency_br }}</strong></td>
                            </tr>
                            <tr>
                                <td>PIX</td>
                                <td class="text-right"><strong>{{ totais_meio.pix|currency_br }}</strong></td>
                            </tr>
                            <tr>
                                <td>Dinheiro (apurado)</td>
                                <td class="text-right"><strong>{{ totais.vendas_dinheiro_final|currency_br }}</strong></td>
                            </tr>
                            <tr>
                                <td>iFood (líquido s/ taxa)</td>
                                <td class="text-right"><strong>{{ extras_meio.ifood_liquido|currency_br }}</strong></td>
                            </tr>
                            <tr>
                                <td>99 Food</td>
                                <td class="text-right"><strong>{{ extras_meio.food99|currency_br }}</strong></td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td>Total Geral</td>
                                <td class="text-right">
                                    <strong>{{ (totais_meio.debito + totais_meio.credito + totais_meio.pix + totais.vendas_dinheiro_final + extras_meio.ifood_liquido + extras_meio.food99)|currency_br }}</strong>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                 <!-- PEDIDOS E MARKETPLACES -->
                <div class="card">
                    <h2>Pedidos e Marketplaces</h2>
                    <table class="table">
                        <tbody>
                            <tr>
                                <td>Balcão — pedidos</td>
                                <td class="text-right"><strong>{{ pedidos_detalhe.balcao }}</strong></td>
                            </tr>
                            <tr>
                                <td>WhatsApp — pedidos</td>
                                <td class="text-right"><strong>{{ pedidos_detalhe.zap }}</strong></td>
                            </tr>
                            <tr>
                                <td>VUCA — pedidos</td>
                                <td class="text-right"><strong>{{ pedidos_detalhe.vuca }}</strong></td>
                            </tr>
                            <tr>
                                <td>Taxa de entrega (valor)</td>
                                <td class="text-right"><strong>{{ pedidos_detalhe.taxa_entrega|currency_br }}</strong></td>
                            </tr>
                            <tr style="font-weight: bold; border-top: 2px solid var(--border-color);">
                                <td>Total (sem iFood/99)</td>
                                <td class="text-right"><strong>{{ pedidos_detalhe.total_sem_mp }}</strong></td>
                            </tr>
                            <tr>
                                <td>iFood — pedidos / valor (líquido)</td>
                                <td class="text-right">
                                    <strong>{{ ifood_info.pedidos }}</strong> &nbsp;•&nbsp;
                                    <strong>{{ ifood_info.liquido|currency_br }}</strong>
                                    <small style="color:var(--text-secondary)"> (cancelado: {{ ifood_info.cancelado|currency_br }})</small>
                                </td>
                            </tr>
                            <tr>
                                <td>99 Food — pedidos / valor</td>
                                <td class="text-right">
                                    <strong>{{ n99_info.pedidos }}</strong> &nbsp;•&nbsp;
                                    <strong>{{ n99_info.valor|currency_br }}</strong>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- SANGRIA -->
                <div class="card">
                    <h2>Sangrias do Dia</h2>
                     <table class="table">
                        <thead>
                            <tr>
                                <th>Descrição</th>
                                <th>Forma de Pagamento</th>
                                <th class="text-right">Valor</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for s in sangrias %}
                            <tr>
                                <td>{{ s.descricao }}</td>
                                <td>{{ s.forma }}</td>
                                <td class="text-right">{{ s.valor|currency_br }}</td>
                            </tr>
                            {% else %}
                            <tr><td colspan="3" style="color: var(--text-secondary);">Sem sangrias registradas.</td></tr>
                            {% endfor %}
                        </tbody>
                         <tfoot>
                            <tr>
                                <td colspan="2">Total Sangrias</td>
                                <td class="text-right"><strong>{{ sangrias_total|currency_br }}</strong></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

            <!-- COLUNA LATERAL -->
            <div class="col-span-4">
                <!-- CONFERÊNCIA DE DINHEIRO -->
                <div class="card">
                    <h2>Conferência de Dinheiro</h2>
                    <div class="details-grid">
                        <div class="details-item"><div class="label">Caixa Inicial</div><div class="value">{{ registro.valor_inicial_caixa|currency_br }}</div></div>
                        <div class="details-item"><div class="label">Caixa Final</div><div class="value">{{ registro.valor_final_caixa|currency_br }}</div></div>
                        <div class="details-item"><div class="label">Vendas Dinheiro (Vuca)</div><div class="value">{{ totais.vendas_dinheiro_vuca|currency_br }}</div></div>
                        <div class="details-item"><div class="label">Sangrias em Dinheiro</div><div class="value">{{ totais.sangrias_dinheiro|currency_br }}</div></div>
                        <div class="details-item"><div class="label">Previsão em Caixa</div><div class="value">{{ totais.previsao_caixa|currency_br }}</div></div>
                        <div class="details-item"><div class="label">Entrada de Dinheiro</div><div class="value">{{ totais.entrada_dinheiro|currency_br }}</div></div>
                        <div class="details-item"><div class="label">Vendido em dinheiro (apurado)</div><div class="value"><strong>{{ totais.vendas_dinheiro_final|currency_br }}</strong></div></div>
                    </div>
                    <hr style="border-top: 1px solid var(--border-color); border-bottom: none; margin: 1rem 0;">
                    <div class="highlight-box">
                        <div class="label">QUEBRA DE CAIXA (Sobra / Falta)</div>
                        <div class="value {{ 'text-success' if totais.quebra_caixa >= 0 else 'text-danger' }}">{{ totais.quebra_caixa|currency_br }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

